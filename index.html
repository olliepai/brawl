<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <title></title>
</head>

<body>
  <canvas id="canvas" width=1000 height=750 />
</body>

<script type="text/javascript" src="./camera.js"></script>

<script>
  var canvas = document.getElementById("canvas");
  var context = canvas.getContext("2d");

  document.addEventListener("keydown", keyDown);
  document.addEventListener("keyup", keyUp);

  var fighter = new Fighter(64, 500, "#25a8ea");
  var challenger = new Fighter(1000 - 64 - 50, 500, "#f49242");

  var camera = new Camera();

  setInterval(run, 1000/60);

  function run() {
    camera.drawBackground(fighter, challenger);
    fighter.physics();
    challenger.physics();
    fighter.move();
    challenger.move();
    fighter.draw();
    challenger.draw();
  }

  function keyDown(event) {
    if (event.key == 'a' && fighter.direction != fighter.LEFT) {
      fighter.direction = fighter.LEFT;
    } else if (event.key == 'd' && fighter.direction != fighter.RIGHT) {
      fighter.direction = fighter.RIGHT;
    } else if (event.key == 'w') {
      fighter.jump();
    }

    if (event.key == 'j' && challenger.direction != challenger.LEFT) {
      challenger.direction = challenger.LEFT;
    } else if (event.key == 'l' && challenger.direction != challenger.RIGHT) {
      challenger.direction = challenger.RIGHT;
    } else if (event.key == 'i') {
      challenger.jump();
    }
  }

  function keyUp(event) {
    if (event.key == 'a' && fighter.direction == fighter.LEFT) {
      fighter.direction = fighter.STILL;
    } else if (event.key == 'd' && fighter.direction == fighter.RIGHT) {
      fighter.direction = fighter.STILL;
    }

    if (event.key == 'j' && challenger.direction == challenger.LEFT) {
      challenger.direction = challenger.STILL;
    } else if (event.key == 'l' && challenger.direction == challenger.RIGHT) {
      challenger.direction = challenger.STILL;
    }
  }

  function manageState() {

  }

  function Fighter(x, y, color) {
    this.color = color;

    this.x = x;
    this.y = y;
    this.width = 50;
    this.height = 50;

    this.direction;
    this.STILL = 0;
    this.LEFT = -1;
    this.RIGHT = 1;
    this.direction = this.STILL;

    this.speedX = 8;
    this.speedY = 0;
    this.gravity = .6;

    this.isJumping = false;

    this.move = function() {
      if (this.direction == this.LEFT && this.x > 0) {
        this.x -= this.speedX;
      } else if (this.direction == this.RIGHT && this.x < canvas.width - this.width) {
        this.x += this.speedX;
      }
    }

    this.physics = function() {
      this.speedY += this.gravity;
      this.y += this.speedY;
      if (this.y + 50 >= 660) {
        this.y = 610;
        this.speedY = 0;
        this.isJumping = false;
      }
    }

    this.jump = function() {
      if (this.isJumping == false) {
        this.speedY = -10;
        this.isJumping = true;
      }
    }

    this.draw = function() {
      context.fillStyle = color;
      context.fillRect(this.x, this.y, this.width, this.height);
    }
  }
</script>

</html>
